CREATE DATABASE IF NOT EXISTS ebookdb;

USE ebookdb;

SET SQL_MODE = "NO_AUTO_VALUE_ON_ZERO";
START TRANSACTION;
SET time_zone = "+00:00";

-- Table: book_item
CREATE TABLE IF NOT EXISTS book_item (
  book_id int(20) NOT NULL AUTO_INCREMENT,
  book_name varchar(255) NOT NULL,
  book_desc varchar(255) NOT NULL,
  book_price double(10,2) NOT NULL,
  book_status enum('AVAILABLE', 'DISABLED') NOT NULL DEFAULT 'AVAILABLE',
  PRIMARY KEY (book_id)
) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

-- Table: user
CREATE TABLE IF NOT EXISTS user (
  user_id int(20) NOT NULL AUTO_INCREMENT,
  email varchar(100) NOT NULL UNIQUE,
  password_hash varchar(255) NOT NULL,
  phone_number varchar(30) DEFAULT NULL,
  PRIMARY KEY (user_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

-- Table: cart
CREATE TABLE IF NOT EXISTS cart (
  cart_id int(20) NOT NULL AUTO_INCREMENT,
  user_id int(20) NOT NULL,
  paid boolean DEFAULT FALSE,
  total_price decimal(10,2) DEFAULT NULL,
  PRIMARY KEY (cart_id),
  FOREIGN KEY (user_id) REFERENCES user(user_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

-- Table: cart_item
CREATE TABLE IF NOT EXISTS cart_item (
  cart_id int(20) NOT NULL,
  book_id int(20) NOT NULL,
  quantity int(10) NOT NULL,
  purchase_date date DEFAULT NULL,
  purchase_time time DEFAULT NULL,
  PRIMARY KEY (cart_id, book_id),
  FOREIGN KEY (cart_id) REFERENCES cart(cart_id),
  FOREIGN KEY (book_id) REFERENCES book_item(book_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

-- Table: payment
CREATE TABLE IF NOT EXISTS payment (
  payment_id int(20) NOT NULL AUTO_INCREMENT,
  cart_id int(20) DEFAULT NULL,
  payment_date date DEFAULT NULL,
  total_payment decimal(10,2) DEFAULT NULL,
  user_id int(20) DEFAULT NULL,
  PRIMARY KEY (payment_id),
  FOREIGN KEY (cart_id) REFERENCES cart(cart_id),
  FOREIGN KEY (user_id) REFERENCES user(user_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

INSERT INTO `book_item` (`book_id`, `book_name`, `book_desc`, `book_price`, `book_status`) VALUES
(1, 'Book 1 Title', 'This is the description of Book 1.', 9.99, 'AVAILABLE'),
(2, 'Book 2 Title', 'This is the description of Book 2.', 19.99, 'DISABLED');

COMMIT;
